---
title: Local Development
description: Full local development workflow from env configuration to running all apps
---

The local development workflow follows a strict sequence: configure environment, start infrastructure, start Temporal runtime, run migrations, then start applications.

## Prerequisites

| Requirement | Details |
|-------------|---------|
| Node.js | >= 22 |
| pnpm | 10.x (`corepack enable && corepack prepare pnpm@10.28.0 --activate`) |
| Docker | Must be running (for infrastructure services) |
| 1Password CLI | `op` binary, optional for local dev. Only needed if using secrets from 1Password vaults |

## Step-by-step setup

### 1. Install dependencies

```bash
pnpm install
```

### 2. Configure environment

```bash
pnpm env:configure
```

This script copies `.env.example` to `.env` (if it does not exist) and upserts all required keys with local development defaults:

| Key | Default value |
|-----|---------------|
| `NODE_ENV` | `development` |
| `API_PORT` | `4000` |
| `DATABASE_URL` | `postgres://postgres:postgres@localhost:5432/tx_agent_kit` |
| `AUTH_SECRET` | `local-dev-auth-secret-123456` |
| `API_CORS_ORIGIN` | `http://localhost:3000` |
| `API_BASE_URL` | `http://localhost:4000` |
| `TEMPORAL_RUNTIME_MODE` | `cli` |
| `TEMPORAL_ADDRESS` | `localhost:7233` |
| `TEMPORAL_TASK_QUEUE` | `tx-agent-kit` |
| `OTEL_EXPORTER_OTLP_ENDPOINT` | `http://localhost:4318` |

The script is idempotent. Running it again updates existing keys without duplicating them.

### 3. Start infrastructure

```bash
pnpm infra:ensure
```

This starts all Docker Compose services under the `infra` profile and waits for health checks to pass. Services include PostgreSQL, Redis, the OTEL collector, Jaeger, Prometheus, Grafana, and Loki.

If infrastructure is already running, the command exits immediately. See [Docker Stack](/docs/infrastructure/docker-stack) for service details.

### 4. Start local Temporal CLI runtime

```bash
pnpm temporal:dev:up
```

Use `pnpm temporal:dev:status` to verify readiness.

### 5. Run database migrations

```bash
pnpm db:migrate
```

Drizzle ORM migrations run against the database specified in `DATABASE_URL`. Migrations are defined in `packages/infra/db/src/migrations/`.

### 6. Start all applications

```bash
pnpm dev
```

This runs all application dev servers in parallel via Turborepo:

| App | URL | Port |
|-----|-----|------|
| Web | `http://localhost:3000` | 3000 |
| API | `http://localhost:4000` | 4000 |
| Worker | (background process) | n/a |
| Mobile | `http://localhost:8081/status` (Metro status, default) | 8081 |

You can also start individual applications:

```bash
pnpm dev:web      # Next.js only
pnpm dev:api      # Effect HTTP API only
pnpm dev:worker   # Temporal worker only
pnpm dev:mobile   # Expo React Native only
pnpm dev:mobile:web # Expo web preview (intentional browser target)
```

`pnpm dev:mobile` runs Expo/Metro on `MOBILE_PORT` (default `8081`). Open the actual app using iOS Simulator, Android Emulator, or Expo Go. `http://localhost:8081` is the Metro/web endpoint and is usually not the best native mobile UX.

If you specifically want browser preview, run `pnpm dev:mobile:web` so Expo serves the app intentionally for web.

### 7. Open local dev views (optional)

```bash
pnpm dev:open
```

Run this after `pnpm dev` is up. It opens local app/dev dashboards (web, mobile Metro status, API Swagger, Temporal UI, Grafana, Prometheus, Jaeger) in Brave Browser with a Google Chrome fallback.

## Verifying the setup

After starting all services, verify everything works:

```bash
# Check API health
curl http://localhost:4000/health

# Verify API Swagger endpoint
curl -f http://localhost:4000/docs > /dev/null

# Verify OpenAPI JSON endpoint
curl -f http://localhost:4000/openapi.json > /dev/null

# Open web app
open http://localhost:3000

# Open API Swagger UI
open http://localhost:4000/docs

# Check Temporal CLI runtime
pnpm temporal:dev:status

# Open Grafana dashboards
open http://localhost:3001
```

## Rebuilding contracts

When you change the API, regenerate the OpenAPI spec and client hooks:

```bash
# Generate OpenAPI spec from API routes
pnpm openapi:generate

# Regenerate web + mobile API client hooks
pnpm api:client:generate
```

## Running quality checks

```bash
# Quick checks (reduced output for agent workflows)
pnpm lint:quiet
pnpm type-check:quiet
pnpm test:quiet

# Full output (for debugging failures)
pnpm lint
pnpm type-check
pnpm test

# Integration tests (resets test DB, requires running infra)
pnpm test:integration
```

## Docker is infra-only

In local development, Docker runs only infrastructure services. Applications run as native Node.js processes for fast hot-reload. In staging and production, applications are deployed as container images built by `pnpm deploy:build-images`.
